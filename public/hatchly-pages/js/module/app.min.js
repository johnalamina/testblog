(function(){var e,t,n,a,r,o=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function e(){this.init(),this.events()}return e.prototype.events=function(){return $(".selectable-section, .repeatable-section").each(function(e,t){return $(t).sortable({handle:$(t).children(".panel").children(".panel-heading")})})},e.prototype.init=function(){return new n,new a},e}(),n=function(){function e(){this.events()}return e.prototype.events=function(){var t,n;return $(document).off("click.Hatchly.addRepeatableSection").on("click.Hatchly.addRepeatableSection","[data-add-repeatable-section]",(t=this,function(e){return e.preventDefault(),t.addRepeatableSection(e)})),$(document).off("click.Hatchly.deleteRepeatableSection").on("click.Hatchly.deleteRepeatableSection","[data-delete-repeatable-section]",(n=this,function(e){return e.preventDefault(),n.deleteRepeatableSection(e)}))},e.prototype.addRepeatableSection=function(e){var t,n,a,r;return t=$(e.currentTarget).closest(".repeatable-section-container").find(".repeatable-section").first(),r=$(e.currentTarget).data("section-key"),n=$(e.currentTarget).data("section-collection-keys"),a=$(e.currentTarget).data("page-template"),this.getContent(a,r,n,t)},e.prototype.getContent=function(e,t,n,a){var r;return $.ajax({url:_.trim(Hatchly.admin_url+"/pages/_ajax/repeatable-section/"+Hatchly.pages.page_id+"/"+e+"/"+t+"/"+n,"/")}).done((r=this,function(e){return r.addContent(a,e)}))},e.prototype.addContent=function(e,t){return e.append(t),$("body").trigger("Hatchly.Core.fieldsAdded")},e.prototype.deleteRepeatableSection=function(e){var t,n,a;return a=(t=$(e.currentTarget).closest("[data-section-key]")).data("section-key"),n=t.data("collection-key"),this.deleteContent(a,n,t)},e.prototype.deleteContent=function(e,t,n){var a;return $.ajax({url:Hatchly.admin_url+"/pages/_ajax/repeatable-section/remove",data:{key:e,collection:t,pageId:Hatchly.pages.page_id},headers:{"X-CSRF-TOKEN":Hatchly.token},method:"DELETE"}).done((a=this,function(e){return a.removeContent(n)}))},e.prototype.removeContent=function(e){return e.remove()},e}(),a=function(){function e(){this.events()}return e.prototype.events=function(){var t,n;return $(document).off("click.Hatchly.addSelectableSection").on("click.Hatchly.addSelectableSection","[data-add-selectable-section]",(t=this,function(e){return e.preventDefault(),t.addSelectableSection(e)})),$(document).off("click.Hatchly.deleteSelectableSection").on("click.Hatchly.deleteSelectableSection","[data-delete-selectable-section]",(n=this,function(e){return e.preventDefault(),n.deleteSelectableSection(e)}))},e.prototype.addSelectableSection=function(e){var t,n,a,r,o;return t=$(e.currentTarget).closest(".selectable-section-container").find(".selectable-section"),r=$(e.currentTarget).data("section-key"),a=$(e.currentTarget).data("page-template"),o=$(e.currentTarget).closest(".selectable-section-controls").find("select").val(),n=$(e.currentTarget).data("section-collection-keys"),this.getContent(a,r,t,o,n)},e.prototype.getContent=function(e,t,n,a,r){var o;return $.ajax({url:_.trim(Hatchly.admin_url+"/pages/_ajax/selectable-section/"+Hatchly.pages.page_id+"/"+e+"/"+t+"/"+a+"/"+r,"/")}).done((o=this,function(e){return o.addContent(n,e)}))},e.prototype.addContent=function(e,t){return e.append(t),$("body").trigger("Hatchly.Core.fieldsAdded")},e.prototype.deleteSelectableSection=function(e){var t,n,a;return a=(t=$(e.currentTarget).closest("[data-section-key]")).data("section-key"),n=t.data("collection-key"),this.deleteContent(a,n,t)},e.prototype.deleteContent=function(e,t,n){var a;return $.ajax({url:Hatchly.admin_url+"/pages/_ajax/selectable-section/remove",data:{key:e,collection:t,pageId:Hatchly.pages.page_id},headers:{"X-CSRF-TOKEN":Hatchly.token},method:"DELETE"}).done((a=this,function(e){return a.removeContent(n)}))},e.prototype.removeContent=function(e){return e.remove()},e}(),r=function(){function e(){this.generateSlug=o(this.generateSlug,this),this.registerEvents()}return e.prototype.registerEvents=function(){return $(document).on("keyup change","[data-slugify]",_.debounce(this.generateSlug,1e3)),$(document).on("change","[name=slug]",this.generateSlug)},e.prototype.generateSlug=function(e){var t,n,a;if(!(t=$(e.currentTarget)).data("no-slugify"))return!(n=t.data("slugify")?$(t.data("slugify")):t).length||n.prop("disabled")||n.prop("readonly")?void 0:(a=this.convertToSlug(t.val()),n.val(a),this.verifySlug(a,n))},e.prototype.convertToSlug=function(e){return"-",(e=(e=(e=e.replace("_","-")).toLowerCase().replace(new RegExp("[^a-z0-9-\\s]","g"),"")).replace(new RegExp("[-\\s]+","g"),"-")).replace(new RegExp("^[-\\s]+|[-\\s]+$","g"),"")},e.prototype.verifySlug=function(e,a){return this.request&&this.request.abort(),this.startValidation(a),this.request=$.ajax({url:Hatchly.admin_url+"/pages/_ajax/slug/validate",headers:{"X-CSRF-Token":Hatchly.token},method:"POST",data:{page_id:Hatchly.pages.page_id,language:Hatchly.pages.language,slug:e}}),this.request.success(function(e,t,n){return a.val(n.responseJSON.data.uniqueSlug)}),this.request.error(function(e,t,n){return 422===e.status?a.val(e.responseJSON.data.uniqueSlug):console.log(n)}),this.request.complete((n=this,function(e,t){if("abort"!==t)return n.finishValidation(a)}));var n},e.prototype.startValidation=function(e){var t;return!e.siblings(".validating-icon").length&&(t='<div class="validating-icon" style="'+["position: absolute;","top: 0;","right: 0;","z-index: 2;","padding: 5px;"].join(" ")+'"><i class="fa fa-spinner fa-spin"></i></div>',e.parent().css({position:"relative"}),$(t).insertAfter(e))},e.prototype.finishValidation=function(e){return e.parent().css({position:"relative"}),e.siblings(".validating-icon").remove()},e}(),t=function(){function e(){this.events()}return e.prototype.filtering=!1,e.prototype.slashKeyCode=191,e.prototype.events=function(){var e,t,n;return $(document).ready((e=this,function(){return e.initNestable()})),$(document).on("keyup",(t=this,function(e){if(e.keyCode===t.slashKeyCode)return $("#page-search").focus()})),$(document).on("keyup change","#page-search",(n=this,function(e){return n.filtering=0<$(e.currentTarget).val().length,n.handleFilter($(e.currentTarget).val())}))},e.prototype.handleFilter=function(e){var t,n;return t=[],$(".dd-item").hide().each(function(){if(-1!==$(this).find(".page-title").text().toLowerCase().indexOf(e,0))return t.push($(this))}),_.forEach(t,(n=this,function(e){return n.filterShowAndParent(e)}))},e.prototype.filterShowAndParent=function(e){if(e.show(),0<e.parents(".dd-item").length)return this.filterShowAndParent(e.parents(".dd-item").first())},e.prototype.initNestable=function(){var n;return $(".dd").nestable({limitByType:!0,collapsedByDefault:Hatchly.collapsedByDefault,callback:(n=this,function(e,t){return n.reportNestableChanges($(t))})})},e.prototype.reportNestableChanges=function(e){var t,n,a;return!this.filtering&&(null==(n=e.parent().parent().data("id"))&&(n=0),a=e.prev().data("id"),t=e.next().data("id"),$.ajax({url:Hatchly.admin_url+"/pages/_ajax/order-pages",data:{item:e.data("id"),parent:n,previousSibling:a,nextSibling:t},method:"POST",headers:{"X-CSRF-TOKEN":Hatchly.token}}))},e}(),Vue.component("lat-lng-search",{name:"lat-lng-search",props:["latLng","apiKey"],data:function(){return{lat:null,lng:null,location:""}},map:null,computed:{latLngObject:function(){return{lat:this.lat,lng:this.lng}},latLngJson:function(){return JSON.stringify(this.latLngObject)}},created:function(){return this.addGoogle()},ready:function(){return this.mount()},mounted:function(){return this.mount()},watch:{lat:function(e,t){if(null!==t)return this.recenterMap()},lng:function(e,t){if(null!==t)return this.recenterMap()}},methods:{mount:function(){return this.latLng?this.setLatLng(JSON.parse(this.latLng).lat,JSON.parse(this.latLng).lng):this.setLatLng(53.957696,-1.0855060000000094),this.checkGoogle()},setLatLng:function(e,t){return this.lat=e,this.lng=t},checkGoogle:function(){return"object"==typeof google?(this.initAutocomplete(),this.initMap()):setTimeout((e=this,function(){return e.checkGoogle()}),10);var e},initAutocomplete:function(){var n,a;return(n=new google.maps.places.Autocomplete(this.$refs.autocomplete)).addListener("place_changed",(a=this,function(){var e,t;return e=(t=n.getPlace()).geometry.location,a.location=t.formatted_address,a.setLatLng(e.lat(),e.lng())}))},initMap:function(){return this.map=new google.maps.Map(this.$refs.map,{zoom:16,center:this.latLngObject}),this.marker=new google.maps.Marker({position:this.latLngObject,draggable:!0,map:this.map}),google.maps.event.addListener(this.marker,"dragend",(t=this,function(e){return t.setLatLng(t.marker.position.lat(),t.marker.position.lng())}));var t},addGoogle:function(){var e;if(!document.getElementById("google-maps-script"))return(e=document.createElement("script")).src="https://maps.googleapis.com/maps/api/js?key="+this.apiKey+"&libraries=places",e.id="google-maps-script",document.body.appendChild(e)},recenterMap:function(){if(this.marker&&this.marker.setPosition(this.latLngObject),this.map)return this.map.panTo(this.latLngObject)}}}),$(document).on("Hatchly.start",function(){if(new r,Page.is("pagesindex")&&new t,Page.is("pagesedit")||Page.is("pagescreate"))return new e})}).call(this);
!function(e){e.fn.zclip=function(t){if("object"==typeof t&&!t.length){var n=e.extend({},ZeroClipboard.defaults,t);return this.each(function(){var t=e(this);if(t.is(":visible")&&("string"==typeof n.copy||e.isFunction(n.copy))){ZeroClipboard.setMoviePath(n.path);var i=new ZeroClipboard.Client;e.isFunction(n.copy)&&t.bind("zClip_copy",n.copy),e.isFunction(n.beforeCopy)&&t.bind("zClip_beforeCopy",n.beforeCopy),e.isFunction(n.afterCopy)&&t.bind("zClip_afterCopy",n.afterCopy),i.setHandCursor(n.setHandCursor),i.setCSSEffects(n.setCSSEffects),i.addEventListener("mouseOver",function(e){t.trigger("mouseenter")}),i.addEventListener("mouseOut",function(e){t.trigger("mouseleave")}),i.addEventListener("mouseDown",function(o){t.trigger("mousedown"),e.isFunction(n.beforeCopy)&&t.trigger("zClip_beforeCopy"),e.isFunction(n.copy)?i.setText(t.triggerHandler("zClip_copy")):i.setText(n.copy)}),i.addEventListener("complete",function(i,o){e.isFunction(n.afterCopy)?t.trigger("zClip_afterCopy"):(o.length>500&&(o=o.substr(0,500)+"...\n\n("+(o.length-500)+" characters not shown)"),t.removeClass("hover"),alert("Copied text to clipboard:\n\n "+o)),n.clickAfter&&t.trigger("click")}),i.glue(t[0],t.parent()[0]),e(window).bind("load resize",function(){i.reposition()})}})}if("string"==typeof t)return this.each(function(){var n=e(this);t=t.toLowerCase();var i=n.data("zclipId"),o=e("#"+i+".zclip"),r=o.attr("id").replace(/^.*_/g,"")||null;"remove"==t?(o.remove(),n.removeClass("active hover"),n.unbind("zClip_copy"),n.unbind("zClip_beforeCopy"),n.unbind("zClip_afterCopy"),ZeroClipboard.unregister(r)):"hide"==t?(o.hide(),n.removeClass("active hover")):"show"==t&&o.show()})}}(jQuery);var ZeroClipboard={version:"1.0.7",clients:{},moviePath:"ZeroClipboard.swf",nextId:1,defaults:{path:"ZeroClipboard.swf",clickAfter:!0,setHandCursor:!0,setCSSEffects:!0,copy:null,beforeCopy:null,afterCopy:null},jQuery:function(e){return"string"==typeof e&&(e=document.getElementById(e)),e.addClass||(e.hide=function(){},e.show=function(){this.style.display=""},e.addClass=function(e){this.removeClass(e),this.className+=" "+e},e.removeClass=function(e){for(var t=this.className.split(/\s+/),n=-1,i=0;i<t.length;i++)t[i]==e&&(n=i,i=t.length);return n>-1&&(t.splice(n,1),this.className=t.join(" ")),this},e.hasClass=function(e){return!!this.className.match(new RegExp("\\s*"+e+"\\s*"))}),e},setMoviePath:function(e){this.moviePath=e},dispatch:function(e,t,n){var i=this.clients[e];i&&i.receiveEvent(t,n)},register:function(e,t){this.clients[e]=t},unregister:function(e){"number"==typeof e&&this.clients.hasOwnProperty(e)&&delete this.clients[e]},getDOMObjectPosition:function(e,t){var n={left:0,top:0,width:e.width?e.width:e.offsetWidth,height:e.height?e.height:e.offsetHeight};return e&&e!=t&&(n.left+=e.offsetLeft,n.top+=e.offsetTop),n},Client:function(e){this.handlers={},this.id=ZeroClipboard.nextId++,this.movieId="ZeroClipboardMovie_"+this.id,ZeroClipboard.register(this.id,this),e&&this.glue(e)}};ZeroClipboard.Client.prototype={id:0,ready:!1,movie:null,clipText:"",handCursorEnabled:!0,cssEffects:!0,handlers:null,glue:function(e,t,n){this.domElement=ZeroClipboard.jQuery(e);var i=99;this.domElement.style.zIndex&&(i=parseInt(this.domElement.style.zIndex,10)+1),"string"==typeof t?t=ZeroClipboard.jQuery(t):void 0===t&&(t=document.getElementsByTagName("body")[0]);var o=ZeroClipboard.getDOMObjectPosition(this.domElement,t);this.div=document.createElement("div"),this.div.className="zclip",this.div.id="zclip-"+this.movieId,jQuery(this.domElement).data("zclipId","zclip-"+this.movieId);var r=this.div.style;if(r.position="absolute",r.left=o.left+"px",r.top=o.top+"px",r.width=o.width+"px",r.height=o.height+"px",r.zIndex=i,"object"==typeof n)for(var a in n)r[a]=n[a];t.appendChild(this.div),this.div.innerHTML=this.getHTML(o.width,o.height)},getHTML:function(e,t){var n="",i="id="+this.id+"&width="+e+"&height="+t;if(navigator.userAgent.match(/MSIE/)){n+='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="'+(location.href.match(/^https/i)?"https://":"http://")+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+e+'" height="'+t+'" id="'+this.movieId+'" align="middle"><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+ZeroClipboard.moviePath+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+i+'"/><param name="wmode" value="transparent"/></object>'}else n+='<embed id="'+this.movieId+'" src="'+ZeroClipboard.moviePath+'" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+e+'" height="'+t+'" name="'+this.movieId+'" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+i+'" wmode="transparent" />';return n},hide:function(){this.div&&(this.div.style.left="-2000px")},show:function(){this.reposition()},destroy:function(){if(this.domElement&&this.div){this.hide(),this.div.innerHTML="";var e=document.getElementsByTagName("body")[0];try{e.removeChild(this.div)}catch(e){}this.domElement=null,this.div=null}},reposition:function(e){if(e&&(this.domElement=ZeroClipboard.jQuery(e),this.domElement||this.hide()),this.domElement&&this.div){var t=ZeroClipboard.getDOMObjectPosition(this.domElement),n=this.div.style;n.left=t.left+"px",n.top=t.top+"px"}},setText:function(e){this.clipText=e,this.ready&&this.movie.setText(e)},addEventListener:function(e,t){e=e.toString().toLowerCase().replace(/^on/,""),this.handlers[e]||(this.handlers[e]=[]),this.handlers[e].push(t)},setHandCursor:function(e){this.handCursorEnabled=e,this.ready&&this.movie.setHandCursor(e)},setCSSEffects:function(e){this.cssEffects=!!e},receiveEvent:function(e,t){switch(e=e.toString().toLowerCase().replace(/^on/,"")){case"load":this.movie=document.getElementById(this.movieId);var n=this;if(!this.movie)return void setTimeout(function(){n.receiveEvent("load",null)},1);if(!this.ready&&navigator.userAgent.match(/Firefox/)&&navigator.userAgent.match(/Windows/))return setTimeout(function(){n.receiveEvent("load",null)},100),void(this.ready=!0);this.ready=!0;try{this.movie.setText(this.clipText)}catch(e){}try{this.movie.setHandCursor(this.handCursorEnabled)}catch(e){}break;case"mouseover":this.domElement&&this.cssEffects&&(this.domElement.addClass("hover"),this.recoverActive&&this.domElement.addClass("active"));break;case"mouseout":this.domElement&&this.cssEffects&&(this.recoverActive=!1,this.domElement.hasClass("active")&&(this.domElement.removeClass("active"),this.recoverActive=!0),this.domElement.removeClass("hover"));break;case"mousedown":this.domElement&&this.cssEffects&&this.domElement.addClass("active");break;case"mouseup":this.domElement&&this.cssEffects&&(this.domElement.removeClass("active"),this.recoverActive=!1)}if(this.handlers[e])for(var i=0,o=this.handlers[e].length;i<o;i++){var r=this.handlers[e][i];jQuery.isFunction(r)?r(this,t):"object"==typeof r&&2==r.length?r[0][r[1]](this,t):"string"==typeof r&&window[r](this,t)}}},this.JST={"views/file":function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+="<li>\n    "+(null==(__t=JST["views/thumbnail"]({file:file}))?"":__t)+"\n</li>\n";return __p},"views/folder":function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj)__p+='<li>\n    <div class="gallery-item with-controls folder">\n        <a href="#" data-navigate-directory="'+__e(folder.id)+'">\n            <div class="content">\n                <div class="o">\n                    <div class="i">\n                        ',folder.parent?__p+='\n                            <i class="fa fa-level-up"></i>\n                        ':__p+='\n                            <i class="fa fa-folder"></i>\n                        ',__p+='\n                        <p class="filename">'+__e(folder.name)+"</p>\n                    </div>\n                </div>\n            </div>\n        </a>\n        ",folder.parent||(__p+='\n            <div class="controls">\n                <div class="controls-inner">\n                    <div class="btn-group" role="group" aria-label="actions">\n                        <button type="button" class="btn btn-default" data-toggle="tooltip" data-placement="top" title="Edit" data-trigger="hover" data-edit-folder="'+__e(folder.id)+'">\n                            <i class="fa fa-pencil"></i>\n                        </button>\n                        <button type="button" class="btn btn-default" data-toggle="tooltip" data-placement="top" title="Delete" data-trigger="hover" data-delete-folder=\'{ "id": '+__e(folder.id)+', "name": "'+__e(folder.name)+'" }\'>\n                            <i class="fa fa-close"></i>\n                        </button>\n                    </div>\n                </div>\n            </div>\n        '),__p+="\n    </div>\n</li>";return __p},"views/grid":function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj)__p+="<ul>\n    ",_.each(folders,function(e,t){__p+="\n        "+(null==(__t=JST["views/folder"]({folder:e}))?"":__t)+"\n    "}),__p+="\n    ",_.each(files,function(e,t){__p+="\n        "+(null==(__t=JST["views/file"]({file:e}))?"":__t)+"\n    "}),__p+="\n</ul>";return __p},"views/thumbnail":function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj)itemClasses="gallery-item",file.public_url?(itemClasses+=" with-controls image",image=file.public_url,file.is_image?file.thumbnail_public_url&&(image=file.thumbnail_public_url):itemClasses+=" file"):(itemClasses+=" image-placeholder",image="/hatchly-files/images/module/loader.gif"),__p+='\n<div class="'+__e(itemClasses)+'">\n    <div class="content" style="background-image: url(\''+__e(image)+'\');">\n        <div class="o">\n            <div class="i">\n                ',file.public_url&&(__p+="\n                    ",file.is_image?__p+="\n                        "+__e(file.name)+"\n                    ":(__p+='\n                        <i class="fa fa-file"></i>\n                        ',filename=file.name,filename.length>20&&(filename=file.name.substring(0,20)),__p+='\n                        <p class="filename">'+__e(filename)+"</p>\n                    "),__p+="\n                "),__p+="\n            </div>\n        </div>\n    </div>\n    ",file.public_url&&(__p+='\n        <div class="controls">\n            <div class="controls-inner">\n                <div class="btn-group" role="group" aria-label="actions">\n                    ',$("body").hasClass("page-hatchlyfilesfile-browser")?__p+='\n                        <button type="button" class="btn btn-default" data-toggle="tooltip" data-placement="top" title="Insert file" data-select-file="'+__e(file.id)+'" data-trigger="hover">\n                            <i class="fa fa-link"></i>\n                        </button>\n                    ':__p+='\n                        <button type="button" class="btn btn-default" data-toggle="tooltip" data-placement="top" title="Copy link" data-copy="'+__e(file.public_url)+'" data-trigger="hover">\n                            <i class="fa fa-link"></i>\n                        </button>\n                    ',__p+='\n                    <button type="button" class="btn btn-default" data-toggle="tooltip" data-placement="top" title="Edit" data-trigger="hover" data-edit-file-meta="'+__e(file.id)+'">\n                        <i class="fa fa-pencil"></i>\n                    </button>\n                    <button type="button" class="btn btn-default" data-toggle="tooltip" data-placement="top" title="Delete" data-trigger="hover" data-delete-file=\'{ "id": '+__e(file.id)+', "name": "'+__e(file.name)+'" }\'>\n                        <i class="fa fa-close"></i>\n                    </button>\n                </div>\n            </div>\n        </div>\n    '),__p+="\n</div>\n";return __p}},function(){var e,t,n,i,o,r,a,s,l,c,d=function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},u={}.hasOwnProperty;l=function(){e.prototype.type="grid",e.prototype.directory="",e.prototype.page=1,e.prototype.files=[],e.prototype.loadingPage=!1,e.prototype.hasMore=!0;function e(){this.setDropzoneDefaults(),this.events()}return e.prototype.setDropzoneDefaults=function(){},e.prototype.events=function(){$(document).ready((e=this,function(){return e.documentReady()}));var e;$(document).on("click","[data-trigger-upload]",(t=this,function(e){return e.preventDefault(),t.triggerUpload()}));var t;$(document).on("click","[data-navigate-directory]",(n=this,function(e){return e.preventDefault(),n.changeDirectory(e)}));var n;return $(window).on("dragenter",this.scrollTop),$(window).on("dragleave",this.haltScrollTop),$(window).scroll((i=this,function(){var e;if(e=$("body").outerHeight()-200,$(window).height()+$(window).scrollTop()>e){if(i.loadingPage)return;return i.loadNextPage()}}));var i},e.prototype.loadNextPage=function(){return this.page++,this.getDirectory()},e.prototype.scrollTop=function(){return $("html, body").animate({scrollTop:0},250)},e.prototype.haltScrollTop=function(){return $("html, body").stop()},e.prototype.triggerUpload=function(){return $("#file_uploader").find("[type=file]").trigger("click")},e.prototype.startLoading=function(){return $("section.gallery").addClass("loading")},e.prototype.finishLoading=function(){return ZClip.init(),$("section.gallery").removeClass("loading")},e.prototype.documentReady=function(){return this.getDirectory()},e.prototype.changeView=function(e){return this.type=e,this.resetData(),this.getDirectory()},e.prototype.resetData=function(){return this.files=[],this.hasMore=!0,this.page=1},e.prototype.changeDirectory=function(e){var t;return this.resetData(),t=$(e.currentTarget),window.Hatchly.currentDirectory=this.directory=t.data("navigate-directory"),this.getDirectory()},e.prototype.getDirectory=function(){var e;if(!this.loadingPage&&this.hasMore){this.startLoading(),this.loadingPage=!0,(e=$.ajax({url:Hatchly.admin_url+"/files/_ajax/get_directory",data:{directory:this.directory,page:this.page}})).done((t=this,function(e,n,i){return t.files=t.files.concat(_.toArray(e.files.data)),t.loadingPage=!1,t.render(e),t.hasMore=e.files.next_page_url}));var t;return e.error((n=this,function(e){return bootbox.alert({title:"Oops!",message:'An error occurred while processing your request. Please contact <a href="https://netsells.co.uk/">Netsells</a>.',buttons:{ok:{label:"Close"}}}),n.finishLoading()}));var n}},e.prototype.render=function(e){var t,n;return t=$("#render"),n=JST["views/"+this.type]({files:this.files,folders:e.folders}),t.html(n),$('[data-toggle="tooltip"]').tooltip({container:"body"}),this.finishLoading(),this.attachEvents()},e.prototype.attachEvents=function(){var e;try{return $(".file_uploader").dropzone({previewsContainer:"#render ul",url:Hatchly.files.upload_url,headers:{"X-CSRF-TOKEN":Hatchly.token},sending:(t=this,function(e,n,i){if(t.directory)return i.append("directory_id",t.directory)}),addedfile:function(e){var t,n;return t=$(this.options.previewsContainer),n=JST["views/file"]({file:{}}),t.find(".folder").length?t.find(".folder").last().closest("li").after(n):t.prepend(n)},success:function(e,t){var n,i,o;return n=$(this.options.previewsContainer),i=JSON.parse(e.xhr.response),o=JST["views/file"]({file:i}),n.find(".image-placeholder").first().closest("li").replaceWith(o),ZClip.init()},error:function(e,t,n){return $(this.options.previewsContainer).find(".image-placeholder").first().closest("li").remove(),bootbox.alert(t.errors[0])}})}catch(t){if(e=t,console.log(e.message),"Dropzone already attached."===e.message)return console.log("supress")}var t},e}(),c=function(){function e(){this.init()}return e.prototype.init=function(){return $(document).on("mouseenter","[data-copy]",function(e){if(!$(e.target).hasClass("copy-init"))return $(e.target).zclip({path:"/hatchly-files/vendor/ZeroClipboard.swf",copy:function(){return $(e.target).data("copy")},afterCopy:function(){},beforeCopy:function(){}}),$(e.target).addClass("copy-init")})},e}(),e=function(e){d(t,e);function t(){t.__super__.constructor.apply(this,arguments)}return t.prototype.registerEvents=function(){return $(document).on("click submit","[data-"+this.invoker()+"]",(e=this,function(t,n){return null==n&&(n={}),!!n.confirmed||(t.preventDefault(),e.setupModal(t),e.show())}));var e},t.prototype.setupModal=function(e){var n;return t.__super__.setupModal.apply(this,arguments),n=$(e.currentTarget).data(this.invoker()),this.config.title="Deleting '"+n.name+"'"},t.prototype.confirmCallback=function(e){if(Page.is("filesindex")&&this.deleteFromFileManager(e),Page.is("pagesedit")||Page.is("pagescreate"))return this.deleteFromForm(e)},t.prototype.deleteFromFileManager=function(e){var t,n;t=$(e.currentTarget).data(this.invoker()),(n=$.ajax({url:Hatchly.files.delete_url+"/"+t.id,type:"DELETE",headers:{"X-CSRF-TOKEN":Hatchly.token}})).success((i=this,function(t,n,o){return i.responseSuccess(e,t,n,o)}));var i;n.error((o=this,function(t,n,i){return o.responseError(e,t,n,i)}));var o;n.complete((r=this,function(t,n){return r.responseComplete(e,t,n)}));var r;return!1},t.prototype.deleteFromForm=function(e){var t;return(t=$(e.currentTarget).closest(".image-upload-group")).find("input").val(""),t.find(".thumbnail").data("thumbnail","").data("src","").data("id","").empty()},t.prototype.responseSuccess=function(e,t,n,i){return $(e.currentTarget).closest("li").fadeOut().remove(),this.close()},t.prototype.responseError=function(e,t,n,i){return console.log(t,n,i)},t.prototype.responseComplete=function(e,t,n){},t.prototype.modalContent=function(){return"Are you sure you want to delete this file? This cannot be undone."},t.prototype.invoker=function(){return"delete-file"},t}(window.ConfirmModal),t=function(e){d(t,e);function t(){t.__super__.constructor.apply(this,arguments)}return t.prototype.registerEvents=function(){return $(document).on("click submit","[data-"+this.invoker()+"]",(e=this,function(t,n){return null==n&&(n={}),!!n.confirmed||(t.preventDefault(),e.setupModal(t),e.show())}));var e},t.prototype.setupModal=function(e){var n;return t.__super__.setupModal.apply(this,arguments),n=$(e.currentTarget).data(this.invoker()),this.config.title="Deleting '"+n.name+"'"},t.prototype.confirmCallback=function(e){return this.deleteFromFileManager(e)},t.prototype.deleteFromFileManager=function(e){var t,n;t=$(e.currentTarget).data(this.invoker()),(n=$.ajax({url:Hatchly.files.delete_folder_url+"/"+t.id,type:"DELETE",headers:{"X-CSRF-TOKEN":Hatchly.token}})).success((i=this,function(t,n,o){return i.responseSuccess(e,t,n,o)}));var i;n.error((o=this,function(t,n,i){return o.responseError(e,t,n,i)}));var o;n.complete((r=this,function(t,n){return r.responseComplete(e,t,n)}));var r;return!1},t.prototype.responseSuccess=function(e,t,n,i){return $(e.currentTarget).closest("li").fadeOut().remove(),this.close()},t.prototype.responseError=function(e,t,n,i){return console.log(t,n,i)},t.prototype.responseComplete=function(e,t,n){},t.prototype.modalContent=function(){return"Are you sure you want to delete this folder? This cannot be undone."},t.prototype.invoker=function(){return"delete-folder"},t}(window.ConfirmModal),o=function(){function e(){$(document).on("click","[data-edit-file-meta]",(e=this,function(t){return t.preventDefault(),e.getModalContent(t)}));var e}return e.prototype.getModalContent=function(e){var t,n,i;return n=(t=$(e.currentTarget)).data("edit-file-meta"),i=t.html(),this.startLoading(t),$.ajax({url:"/admin/files/_ajax/get_meta_form/"+n,success:(r=this,function(e){return r.prepareForModal(e)}),complete:(o=this,function(){return o.stopLoading(t,i)})});var o,r},e.prototype.startLoading=function(e){return $(e).html('<i class="fa fa-spinner fa-spin"></i>')},e.prototype.stopLoading=function(e,t){return $(e).html(t)},e.prototype.prepareForModal=function(e){return this.show(e)},e.prototype.show=function(e){return this.modal=bootbox.dialog({message:'<div id="modal-messages"></div>'+e,title:"Edit file meta data",onEscape:function(){}}),this.modal.on("shown.bs.modal",(t=this,function(){return t.registerMetaFormEvents()}));var t},e.prototype.registerMetaFormEvents=function(){this.addToken(),this.modal.off("Hatchly.AjaxForm.submitted").on("Hatchly.AjaxForm.submitted","form",(e=this,function(t,n){return $(t.currentTarget).find("input[type=submit], button[type=submit]").addClass("disabled"),e.clearMessages()}));var e;this.modal.off("Hatchly.AjaxForm.success").on("Hatchly.AjaxForm.success","form",(t=this,function(e,n){return t.generateMessages(n.callback.data.messages,n.callback.jqXHR.status),setTimeout(function(){return t.modal.modal("hide")},500)}));var t;this.modal.off("Hatchly.AjaxForm.error").on("Hatchly.AjaxForm.error","form",(n=this,function(e,t){return n.generateMessages(t.callback.jqXHR.responseJSON.messages,t.callback.jqXHR.status)}));var n;return this.modal.off("Hatchly.AjaxForm.complete").on("Hatchly.AjaxForm.complete","form",function(e,t){return $(e.currentTarget).find("input[type=submit], button[type=submit]").removeClass("disabled")})},e.prototype.generateMessages=function(e,t){return this.clearMessages(),$("#modal-messages").html(CoreJST.alerts({messages:e,status:t}))},e.prototype.clearMessages=function(){return $("#modal-messages").html("")},e.prototype.addToken=function(){return this.modal.find("form").each((e=this,function(t,n){return $(n).find("input[name=_token]").length||$(n).prepend('<input type="hidden" name="_token">'),e.addTokenValue(n)}));var e},e.prototype.addTokenValue=function(e){return $(e).find("input[name=_token]").val(Hatchly.token)},e}(),a=function(){e.currentDirectory=null;function e(){$(document).on("click","[data-edit-folder]",(e=this,function(t){return t.preventDefault(),e.getModalContent(t)}));var e;$(document).on("click","[data-add-folder]",(t=this,function(e){return e.preventDefault(),t.getModalContent(e)}));var t}return e.prototype.getModalContent=function(e,t){var n,i,o;return null==t&&(t=!1),(n=$(e.currentTarget)).data("edit-folder")&&(t=n.data("edit-folder")),o=n.html(),this.startLoading(n),i="/admin/files/_ajax/edit_folder",t||(t=0),i=i+"/"+t,window.Hatchly.currentDirectory&&(i=i+"/"+window.window.Hatchly.currentDirectory),$.ajax({url:i,success:(a=this,function(e){return a.prepareForModal(e,t)}),complete:(r=this,function(){return r.stopLoading(n,o)})});var r,a},e.prototype.startLoading=function(e){return $(e).html('<i class="fa fa-spinner fa-spin"></i>')},e.prototype.stopLoading=function(e,t){return $(e).html(t)},e.prototype.prepareForModal=function(e,t){return this.show(e,t)},e.prototype.show=function(e,t){var n;return n=t?"Edit":"Create new",this.modal=bootbox.dialog({message:'<div id="modal-messages"></div>'+e,title:n+" folder",onEscape:function(){}}),this.modal.on("shown.bs.modal",(i=this,function(){return i.registerMetaFormEvents()}));var i},e.prototype.registerMetaFormEvents=function(){this.addToken(),this.modal.off("Hatchly.AjaxForm.submitted").on("Hatchly.AjaxForm.submitted","form",(e=this,function(t,n){return $(t.currentTarget).find("input[type=submit], button[type=submit]").addClass("disabled"),e.clearMessages()}));var e;this.modal.off("Hatchly.AjaxForm.success").on("Hatchly.AjaxForm.success","form",(t=this,function(e,n){return t.generateMessages(n.callback.data.messages,n.callback.jqXHR.status),setTimeout(function(){return t.modal.modal("hide"),window.location.reload(!0)},500)}));var t;this.modal.off("Hatchly.AjaxForm.error").on("Hatchly.AjaxForm.error","form",(n=this,function(e,t){return n.generateMessages(t.callback.jqXHR.responseJSON.messages,t.callback.jqXHR.status)}));var n;return this.modal.off("Hatchly.AjaxForm.complete").on("Hatchly.AjaxForm.complete","form",function(e,t){return $(e.currentTarget).find("input[type=submit], button[type=submit]").removeClass("disabled")})},e.prototype.generateMessages=function(e,t){return this.clearMessages(),$("#modal-messages").html(CoreJST.alerts({messages:e,status:t}))},e.prototype.clearMessages=function(){return $("#modal-messages").html("")},e.prototype.addToken=function(){return this.modal.find("form").each((e=this,function(t,n){return $(n).find("input[name=_token]").length||$(n).prepend('<input type="hidden" name="_token">'),e.addTokenValue(n)}));var e},e.prototype.addTokenValue=function(e){return $(e).find("input[name=_token]").val(Hatchly.token)},e}(),n=function(){function e(){this.registerEvents()}return e.prototype.registerEvents=function(){return $(document).on("click","[data-select-file]",(e=this,function(t){return e.selectFile(t)}));var e},e.prototype.selectFile=function(e){var t;return t=$(e.currentTarget).data("select-file"),this.returnSelectedFile(t)},e.prototype.returnSelectedFile=function(e){return $.ajax({url:"/admin/files/_ajax/get_file/"+e,type:"GET"}).success(function(e,t,n){return parent.$("body").trigger("Hatchly.files.file-selected",e.file),parent.$("body").trigger("Hatchly.Files.existingFileSelected",e.file)})},e}(),i=function(){function e(){this.registerEvents(),this.$clicked=null,this.modal=null}return e.prototype.registerEvents=function(){$(document).on("click","[data-select-existing-file]",(e=this,function(t){return e.$clicked=$(t.currentTarget),e.openFileBrowser()}));var e;return $(document).on("Hatchly.Files.existingFileSelected","body",(t=this,function(e,n){if(t.$clicked)return t.insertFile(n)}));var t},e.prototype.openFileBrowser=function(){this.modal=bootbox.dialog({message:'<iframe src="'+Hatchly.admin_url+'/files/file-browser" frameborder="0" style="width: 100%; height: 500px;"></iframe>'}),this.modal.on("shown.bs.modal",(e=this,function(){return e.modal.find("iframe")[0].contentWindow.location=e.modal.find("iframe").attr("src")}));var e;return this.modal.on("hidden.bs.modal",(t=this,function(){return t.$clicked=!1}));var t},e.prototype.insertFile=function(e){var t,n;return(n=(t=this.$clicked.closest(".image-upload-group")).find(".thumbnail")).attr("data-thumbnail",""),n.attr("data-src",e.thumbnail?e.thumbnail.public_url:e.public_url),n.attr("data-id",e.id),n.attr("data-image",e.is_image),n.attr("data-file-name",e.name),t.find("input[name='"+n.data("input-name")+"']").val(e.id),this.modal.modal("hide"),$("body").trigger("Hatchly.Core.fieldsAdded")},e}(),s=function(){function e(){this.generateThumbnails(),this.setupDropZone(),this.registerEvents()}return e.prototype.registerEvents=function(){return $("body").on("Hatchly.Core.fieldsAdded",(e=this,function(){return e.generateThumbnails(),e.setupDropZone()}));var e},e.prototype.generateThumbnails=function(){return $("[data-thumbnail]").each(function(e,t){var n;if("generated"!==$(t).attr("data-thumbnail")&&""!==$(t).attr("data-src"))return n=JST["views/thumbnail"]({file:{public_url:$(t).attr("data-src"),name:$(t).attr("data-file-name"),id:$(t).attr("data-id"),is_image:$(t).attr("data-image")}}),$(t).html(n),$(t).attr("data-thumbnail","generated")}),ZClip.init()},e.prototype.setupDropZone=function(){return $(".file_uploader").each(function(e,t){var n;if(!$(t).hasClass("dz-clickable"))return n=$(t).data("name"),$(t).dropzone({previewsContainer:"[data-input-name='"+n+"']",url:$(t).data("action"),paramName:"file",headers:{"X-CSRF-TOKEN":Hatchly.token},addedfile:function(e){var t,n;return t=$(this.options.previewsContainer),n=JST["views/thumbnail"]({file:{}}),t.html(n)},success:function(e,t){var i,o,r;return i=$(this.options.previewsContainer),o=JSON.parse(e.xhr.response),r=JST["views/thumbnail"]({file:o}),i.find(".gallery-item").replaceWith(r),$("[name='"+n+"']").val(o.id),ZClip.init()},error:function(e,t,n){return $(this.options.previewsContainer).find(".gallery-item").remove(),bootbox.alert(t.errors[0])}})}),$('[data-toggle="tooltip"]').tooltip({container:"body"})},e}(),r=function(){return function(){new l}}(),$(document).on("Hatchly.start",function(){if(window.ZClip=new c,new e,Page.is("filesindex")&&(new t,new r(new o,new a)),Page.is("pagesedit")&&(new i,new s(new o)),Page.is("filesfile-browser"))return new n})}.call(this);